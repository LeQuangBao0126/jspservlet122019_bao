package repository.impl;

import java.util.List;
import java.util.Map;

import org.apache.commons.lang.StringUtils;

import builder.BuildingSearchBuilder;
import entity.BuildingEntity;
import repository.IBuildingRepository;

public class BuildingRepository extends SimpleJPArepository<BuildingEntity> implements IBuildingRepository {

	@Override
	public void insert() {
	
	}

	@Override
	public List<BuildingEntity> findAll(Map<String,Object> params,BuildingSearchBuilder builder) {
		StringBuilder result = new StringBuilder("select * from building b where 1=1 "); 
		result = createSQLfindAllcommon(result,params);
		return this.findAll(result.toString());
	}

	private StringBuilder createSQLfindAllcommon(StringBuilder sql,Map<String,Object> params ) {
		if(params!=null && params.size() > 0) {
		   	String[] keys = new String[params.size()];
		   	Object[] values = new Object[params.size()];
		   	int index = 0;
		   	for(Map.Entry<String,Object> item : params.entrySet()) {
		   		keys[index] = item.getKey();
		   		values[index] = item.getValue();
		   		index++;
		   	}
		   	for(int i = 0; i< keys.length ;i++) {  		
		   		if(values[i] instanceof String) {
		   			if(StringUtils.isNotBlank(values[i].toString())) {
		   				sql.append(" and b"+keys[i]+" like '%"+values[i]+"%'");
		   			}		   			
		   		}else {
		   			if(values[i] != null) {
		   				sql.append(" and b"+keys[i]+" = "+values[i]+"");
		   			}	   			
		   		}
		   	}
		}  
		//nếu tất cả ko thoả thì vẫn return lại câu sql cũ
		return sql;
	}

}
